<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Diary Analyzer - Beautiful Calendar Analytics</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="Beautiful time series visualization for your Google Calendar diary entries. Track productivity, analyze patterns, and gain insights into how you spend your time.">
    <meta name="keywords" content="calendar analytics, time tracking, productivity, Google Calendar, data visualization, diary analyzer">
    <meta name="author" content="Diary Analyzer">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Diary Analyzer - Beautiful Calendar Analytics">
    <meta property="og:description" content="Beautiful time series visualization for your Google Calendar diary entries. Track productivity and gain insights.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://diary-analyzer.vercel.app">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Diary Analyzer - Beautiful Calendar Analytics">
    <meta name="twitter:description" content="Beautiful time series visualization for your Google Calendar diary entries.">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="icons/icon16.svg">
    <link rel="apple-touch-icon" href="icons/icon48.svg">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="styles.css" as="style">
    <link rel="preload" href="https://accounts.google.com/gsi/client" as="script">
    
    <!-- Stylesheet -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Load Google API Client Library for proper OAuth -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
    <div class="app-container">
        <header class="app-header">
            <div class="header-content">
                <h1>üìä Diary Analyzer</h1>
                <p class="header-subtitle">Beautiful time series visualization for your Google Calendar diary entries</p>
                <div class="controls">
                    <button id="refreshBtn" class="refresh-btn">üîÑ Refresh</button>
                    <button id="signOutBtn" class="signout-btn hidden">üö™ Sign Out</button>
                </div>
            </div>
        </header>

        <main class="app-main">
            <!-- Auth Section -->
            <section id="authSection" class="auth-section">
                <div class="auth-card">
                    <h2>üìä Welcome to Diary Analyzer</h2>
                    <p>Sign in with your Google account to view and analyze your calendar diary entries</p>
                    
                    <!-- Custom Sign-In Button with OAuth Token Request -->
                    <div id="buttonDiv"></div>
                    
                    <p class="auth-note">We only request read-only access to your calendar data</p>
                </div>
            </section>

            <!-- Loading Section -->
            <section id="loadingSection" class="loading-section hidden">
                    <div class="loading-spinner"></div>
                <p id="loadingMessage">Loading your calendar data...</p>
                <p id="loadingDetails" style="font-size: 0.85rem; color: #888; margin-top: 0.5rem;"></p>
            </section>

            <!-- Error Section -->
            <section id="errorSection" class="error-section hidden">
                <div class="error-card">
                    <h2>‚ö†Ô∏è Something went wrong</h2>
                    <p id="errorMessage"></p>
                    <button id="retryBtn" class="retry-btn">Try Again</button>
                </div>
            </section>

            <!-- Content Section -->
            <section id="contentSection" class="content-section">
                <!-- Tab Navigation -->
                <div class="tab-navigation">
                    <button id="highlightsTab" class="tab-btn active">‚≠ê Highlights & Milestones</button>
                    <button id="analyticsTab" class="tab-btn">üìä Analytics</button>
                </div>
                
                <!-- Highlights Tab Content -->
                <div id="highlightsTabContent" class="tab-content active">
                <!-- Main Calendar View -->
                <div class="main-calendar-view">
                    <div class="calendar-header">
                        <h2>‚≠ê Highlights & Milestones Calendar</h2>
                        <div class="calendar-controls">
                            <button id="prevYear" class="calendar-nav-btn">‚Üê Previous Year</button>
                            <span id="currentYear" class="current-year">2024</span>
                            <button id="nextYear" class="calendar-nav-btn">Next Year ‚Üí</button>
                        </div>
                        <button id="highlightsLogButton" class="log-btn">üìù Log Highlight</button>
                    </div>
                    <div class="calendar-wrapper">
                        <div id="calendarGrid" class="calendar-grid">
                            <!-- Calendar will be dynamically generated here -->
                        </div>
                    </div>
                </div>
                </div> <!-- End Highlights Tab Content -->
                
                <!-- Analytics Tab Content -->
                <div id="analyticsTabContent" class="tab-content">
                    <!-- Analytics Controls -->
                    <div class="analytics-controls">
                        <select id="dateRange" class="date-selector">
                            <option value="today">Today</option>
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="quarter">This Quarter</option>
                            <option value="year">This Year</option>
                        </select>
                        <select id="viewMode" class="view-selector">
                            <option value="distribution">Distribution</option>
                            <option value="timeline">Timeline</option>
                            <option value="advanced">Advanced Analytics</option>
                            <option value="aggregated">Category Trends</option>
                        </select>
                        <button id="logButton" class="log-btn">üìù Quick Log</button>
                        <button id="randomRecapBtn" class="random-recap-btn">üé≤ Random Recap</button>
                    </div>
                    
                    <div class="stats-container">
                    <div class="stat-card">
                        <h3>Total Events</h3>
                        <p id="totalEvents" class="stat-value">0</p>
                    </div>
                    <div class="stat-card">
                        <h3>Active Hours</h3>
                        <p id="activeHours" class="stat-value">0h 0m</p>
                    </div>
                    <div class="stat-card">
                        <h3>Most Common</h3>
                        <p id="mostCommon" class="stat-value">-</p>
                </div>
            </div>

                <!-- Navigation -->
                <div class="date-navigation">
                    <button id="prevDay" class="nav-btn">‚Üê Prev</button>
                    <span id="currentDate" class="current-date">Today</span>
                    <button id="nextDay" class="nav-btn">Next ‚Üí</button>
                </div>

                <!-- Timeline View -->
                <div id="timelineContainer" class="timeline-container hidden">
                    <h3>Timeline</h3>
                    <div id="timeline" class="timeline"></div>
                </div>

                <!-- Distribution View -->
                <div id="distributionContainer" class="distribution-container">
                    <h3>Time Distribution</h3>
                    <p class="distribution-subtitle">Daily time distribution by calendar</p>
                    <div id="distributionChart" class="distribution-chart"></div>
                    <div id="distributionStats" class="distribution-stats"></div>
                </div>

                <!-- Advanced Analytics View -->
                <div id="advancedContainer" class="advanced-container hidden">
                    <h3>Advanced Analytics</h3>
                    <div id="advancedCharts" class="advanced-charts">
                        <!-- Charts will be dynamically inserted here -->
                    </div>
                </div>

                <!-- Aggregated Category Trends View -->
                <div id="aggregatedContainer" class="aggregated-container hidden">
                    <h3>Category Trends</h3>
                    <div class="aggregated-controls">
                        <div class="control-group">
                            <label for="aggregationPeriod">Aggregation Period:</label>
                            <select id="aggregationPeriod" class="period-selector">
                                <option value="weekly">Weekly</option>
                                <option value="monthly">Monthly</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="showEventCount">Show Event Count:</label>
                            <input type="checkbox" id="showEventCount" class="event-count-toggle">
                        </div>
                        <div class="control-group">
                            <button id="refreshCategoryTrends" class="refresh-category-btn">üîÑ Refresh</button>
                        </div>
                    </div>
                    <div id="aggregatedChart" class="aggregated-chart">
                        <!-- Chart will be dynamically inserted here -->
                    </div>
                </div>
                </div> <!-- End Analytics Tab Content -->
            </section>
        </main>
        
        <!-- Day Details Popup Modal -->
        <div id="dayDetailsModal" class="day-details-modal hidden">
            <div class="day-details-modal-content">
                <div class="day-details-header">
                    <h2 id="dayDetailsTitle">Day Details</h2>
                    <button class="day-details-close" onclick="closeDayDetailsModal()">&times;</button>
                </div>
                <div class="day-details-content">
                    <div id="dayDetailsDate" class="day-details-date"></div>
                    <div id="dayDetailsEvents" class="day-details-events">
                        <!-- Calendar events will be shown here -->
                    </div>
                    <div id="dayDetailsHighlights" class="day-details-highlights">
                        <!-- Highlights and milestones will be shown here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Random Recap Popup Modal -->
        <div id="randomRecapModal" class="random-recap-modal hidden">
            <div class="random-recap-modal-content">
                <div class="random-recap-header">
                    <h2>üé≤ Random Recap</h2>
                    <button class="random-recap-close" onclick="closeRandomRecapModal()">&times;</button>
                </div>
                
                <div class="random-recap-settings">
                    <h3>Settings</h3>
                    <div class="random-recap-form-group">
                        <label for="lookbackPeriod">Lookback Period:</label>
                        <select id="lookbackPeriod" class="random-recap-lookback-select">
                            <option value="7">1 Week</option>
                            <option value="30">1 Month</option>
                            <option value="90">3 Months</option>
                            <option value="180">6 Months</option>
                            <option value="365" selected>1 Year</option>
                            <option value="730">2 Years</option>
                        </select>
                        <button id="generateRandomRecap" class="random-recap-generate-btn">üé≤ Generate Random Day</button>
                    </div>
                </div>
                
                <div class="random-recap-content">
                    <div class="random-recap-loading hidden">
                        <div class="random-recap-loading-spinner"></div>
                        <p>Finding a random day with activities...</p>
                    </div>
                    <div id="randomRecapResults"></div>
                </div>
            </div>
        </div>

        <!-- Log Highlight Popup Modal -->
        <div id="logModal" class="log-modal hidden">
            <div class="log-modal-content">
                <div class="log-modal-header">
                    <h2>üìù Log Highlight or Milestone</h2>
                    <button class="log-modal-close" onclick="closeHighlightModal()">&times;</button>
                </div>
                
                <div class="log-modal-body">
                    <form id="logForm" class="log-form">
                        <div class="form-group">
                            <label for="highlightDate">Date:</label>
                            <input type="date" id="highlightDate" name="highlightDate" class="date-input" required>
                        </div>
                        <div class="form-group">
                            <label for="highlightTitle">Title:</label>
                            <input type="text" id="highlightTitle" name="highlightTitle" class="title-input" placeholder="Enter highlight or milestone title" required>
                        </div>
                        <div class="form-group">
                            <label for="highlightDescription">Description:</label>
                            <textarea id="highlightDescription" name="highlightDescription" class="description-input" placeholder="Enter description (optional)"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="highlightType">Type:</label>
                            <select id="highlightType" name="highlightType" class="type-select" required>
                                <option value="highlight">Highlight</option>
                                <option value="milestone">Milestone</option>
                                <option value="achievement">Achievement</option>
                                <option value="memory">Memory</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="cancel-btn" onclick="closeHighlightModal()">Cancel</button>
                            <button type="submit" id="saveHighlight" class="save-highlight-btn">üíæ Save Highlight</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <footer class="app-footer">
            ¬© 2024 Diary Analyzer. Made with ‚ù§Ô∏è for productivity enthusiasts.
        </footer>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- config.js must load BEFORE app.js, so no defer -->
    <script src="config.js"></script>
    
    <!-- Google OAuth Setup - Authorization Code Flow with Backend -->
    <script>
        // ============================================
        // BACKEND-BASED OAUTH WITH REFRESH TOKENS
        // ============================================
        
        // Helper function to update loading message with details
        function updateLoadingMessage(mainMessage, details = '') {
            const loadingMsg = document.getElementById('loadingMessage');
            const loadingDetails = document.getElementById('loadingDetails');
            if (loadingMsg) loadingMsg.textContent = mainMessage;
            if (loadingDetails) loadingDetails.textContent = details;
            console.log('üì¢', mainMessage, details ? `(${details})` : '');
        }
        
        // Get stored user session
        function getStoredSession() {
            try {
                const data = localStorage.getItem('diaryAnalyzerSession');
                if (data) {
                    return JSON.parse(data);
                }
            } catch (e) {
                console.error('‚ùå Error parsing session data:', e);
            }
            return null;
        }
        
        // Store user session
        function storeSession(sessionData) {
            localStorage.setItem('diaryAnalyzerSession', JSON.stringify(sessionData));
            console.log('üíæ Session stored for user:', sessionData.user?.email);
        }
        
        // Clear session
        function clearSession() {
            localStorage.removeItem('diaryAnalyzerSession');
            localStorage.removeItem('googleToken');
            localStorage.removeItem('googleTokenData');
            console.log('üóëÔ∏è Session cleared');
        }
        
        // Check if session is valid (has user_id for backend calls)
        function isSessionValid() {
            const session = getStoredSession();
            return session && session.user_id && session.access_token;
        }
        
        // ============================================
        // GOOGLE AUTH - AUTHORIZATION CODE FLOW
        // ============================================
        
        // Build the Google OAuth URL for authorization code flow
        function buildGoogleAuthUrl() {
            const params = new URLSearchParams({
                client_id: CONFIG.GOOGLE_CLIENT_ID,
                redirect_uri: window.location.origin + window.location.pathname,
                response_type: 'code',
                scope: CONFIG.GOOGLE_SCOPES.join(' '),
                access_type: 'offline',  // This requests a refresh token!
                prompt: 'consent',        // Always show consent to get refresh token
                state: 'diary_analyzer_auth'
            });
            
            return `https://accounts.google.com/o/oauth2/v2/auth?${params.toString()}`;
        }
        
        // Handle the OAuth callback (when Google redirects back with auth code)
        async function handleOAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            const state = urlParams.get('state');
            const error = urlParams.get('error');
            
            // Clear URL parameters
            if (code || error) {
                window.history.replaceState({}, document.title, window.location.pathname);
            }
            
            if (error) {
                console.error('‚ùå OAuth error:', error);
                document.getElementById('errorMessage').textContent = `Authentication failed: ${error}`;
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('errorSection').classList.remove('hidden');
                return false;
            }
            
            if (code && state === 'diary_analyzer_auth') {
                console.log('üîë Got authorization code, exchanging for tokens...');
                
                document.getElementById('authSection').classList.add('hidden');
                document.getElementById('loadingSection').classList.remove('hidden');
                updateLoadingMessage('Completing sign-in...', 'Exchanging authorization code...');
                
                try {
                    // Exchange code for tokens via backend
                    const response = await fetch(CONFIG.AUTH_FUNCTION_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                        },
                        body: JSON.stringify({
                            action: 'exchange',
                            code: code,
                            redirect_uri: window.location.origin + window.location.pathname
                        })
                    });
                    
                    const result = await response.json();
                    
                    if (!result.success) {
                        throw new Error(result.error || 'Token exchange failed');
                    }
                    
                    console.log('‚úÖ Token exchange successful!');
                    console.log('üë§ User:', result.user?.email);
                    console.log('üîÑ Has refresh token:', result.has_refresh_token);
                    
                    // Store session
                    const session = {
                        user_id: result.user.id,
                        access_token: result.access_token,
                        expires_at: result.expires_at,
                        user: result.user,
                        has_refresh_token: result.has_refresh_token
                    };
                    storeSession(session);
                    
                    // Also set for backward compatibility
                    window.accessToken = result.access_token;
                    window.globalAccessToken = result.access_token;
                    window.currentUserId = result.user.id;
                    
                    updateLoadingMessage('Sign-in successful!', 'Loading calendar data...');
                    return true;
                    
                } catch (error) {
                    console.error('‚ùå Token exchange failed:', error);
                    document.getElementById('errorMessage').textContent = `Sign-in failed: ${error.message}`;
                    document.getElementById('loadingSection').classList.add('hidden');
                    document.getElementById('errorSection').classList.remove('hidden');
                    return false;
                }
            }
            
            return false;
        }
        
        // Refresh token via backend
        async function refreshTokenViaBackend(userId) {
            console.log('üîÑ Refreshing token via backend...');
            
            try {
                const response = await fetch(CONFIG.AUTH_FUNCTION_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${CONFIG.SUPABASE_ANON_KEY}`
                    },
                    body: JSON.stringify({
                        action: 'refresh',
                        user_id: userId
                    })
                });
                
                const result = await response.json();
                
                if (!result.success) {
                    throw new Error(result.error || 'Token refresh failed');
                }
                
                console.log('‚úÖ Token refreshed via backend!');
                
                // Update stored session
                const session = getStoredSession();
                if (session) {
                    session.access_token = result.access_token;
                    session.expires_at = result.expires_at;
                    storeSession(session);
                }
                
                // Update global variables
                window.accessToken = result.access_token;
                window.globalAccessToken = result.access_token;
                
                return result.access_token;
                
            } catch (error) {
                console.error('‚ùå Backend token refresh failed:', error);
                throw error;
            }
        }
        
        // Expose refresh function globally
        window.refreshGoogleToken = async function() {
            const session = getStoredSession();
            if (!session || !session.user_id) {
                throw new Error('No session found. Please sign in again.');
            }
            return refreshTokenViaBackend(session.user_id);
        };
        
        // Get current user ID
        window.getCurrentUserId = function() {
            const session = getStoredSession();
            return session?.user_id || window.currentUserId;
        };
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        async function initializeAuth() {
            console.log('üîß Initializing authentication...');
            console.log('üîß Using backend proxy:', CONFIG.USE_BACKEND_PROXY);
            
            // First, check if this is an OAuth callback
            const wasCallback = await handleOAuthCallback();
            
            if (wasCallback) {
                // Successfully authenticated via callback, load data
                await loadAppData();
                return;
            }
            
            // Check for existing session
            const session = getStoredSession();
            
            if (session && session.user_id && session.access_token) {
                console.log('‚ôªÔ∏è Found existing session for:', session.user?.email);
                
                // Set global variables
                window.accessToken = session.access_token;
                window.globalAccessToken = session.access_token;
                window.currentUserId = session.user_id;
                
                // Check if token is expired
                const expiresAt = new Date(session.expires_at).getTime();
                const isExpired = Date.now() > expiresAt;
                
                if (isExpired && session.has_refresh_token) {
                    console.log('‚è∞ Token expired, refreshing via backend...');
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('loadingSection').classList.remove('hidden');
                    updateLoadingMessage('Refreshing credentials...', 'Please wait...');
                    
                    try {
                        await refreshTokenViaBackend(session.user_id);
                        console.log('‚úÖ Token refreshed successfully!');
                        await loadAppData();
                        return;
                    } catch (error) {
                        console.error('‚ùå Token refresh failed:', error);
                        clearSession();
                        // Fall through to show sign-in
                    }
                } else if (!isExpired) {
                    // Token is still valid
                    console.log('‚úÖ Session is valid, loading app...');
                    document.getElementById('authSection').classList.add('hidden');
                    document.getElementById('loadingSection').classList.remove('hidden');
                    updateLoadingMessage('Loading...', 'Using stored credentials...');
                    await loadAppData();
                    return;
                }
            }
            
            // No valid session, show sign-in button
            console.log('üîê No valid session, showing sign-in button');
            renderSignInButton();
        }
        
        // Render the sign-in button
        function renderSignInButton() {
            const buttonDiv = document.getElementById("buttonDiv");
            buttonDiv.innerHTML = `
                <button id="customGoogleBtn" style="
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 12px;
                    background: white;
                    border: 1px solid #dadce0;
                    border-radius: 4px;
                    padding: 10px 12px;
                    font-family: 'Google Sans', Roboto, Arial, sans-serif;
                    font-size: 14px;
                    font-weight: 500;
                    color: #3c4043;
                    cursor: pointer;
                    transition: background-color 0.3s, box-shadow 0.3s;
                    min-width: 17vw;
                " onmouseover="this.style.backgroundColor='#f8f9fa'; this.style.boxShadow='0 1px 2px 0 rgba(60,64,67,.30), 0 1px 3px 1px rgba(60,64,67,.15)';" 
                   onmouseout="this.style.backgroundColor='white'; this.style.boxShadow='none';">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path fill="#4285F4" d="M16.51 8H8.98v3h4.3c-.18 1-.74 1.48-1.6 2.04v2.01h2.6a7.8 7.8 0 0 0 2.38-5.88c0-.57-.05-.66-.15-1.18z"/>
                        <path fill="#34A853" d="M8.98 17c2.16 0 3.97-.72 5.3-1.94l-2.6-2.01a4.8 4.8 0 0 1-7.18-2.54H1.83v2.07A8 8 0 0 0 8.98 17z"/>
                        <path fill="#FBBC05" d="M4.5 10.52A4.8 4.8 0 0 1 4.5 7.48V5.41H1.83a8 8 0 0 0 0 7.18l2.67-2.07z"/>
                        <path fill="#EA4335" d="M8.98 4.18c1.17 0 2.23.4 3.06 1.2l2.3-2.3A8 8 0 0 0 1.83 5.4L4.5 7.49a4.77 4.77 0 0 1 4.48-3.3z"/>
                    </svg>
                    Sign in with Google
                </button>
            `;
            
            document.getElementById("customGoogleBtn").addEventListener('click', () => {
                console.log('üñ±Ô∏è Sign-in button clicked, redirecting to Google...');
                window.location.href = buildGoogleAuthUrl();
            });
            
            console.log('‚úÖ Sign-in button rendered');
        }
        
        // Load app data after authentication
        async function loadAppData() {
            const tryLoadCalendarData = (attempts = 0, maxAttempts = 10) => {
                console.log(`üîÑ Attempt ${attempts + 1}/${maxAttempts} to load calendar data...`);
                
                if (window.loadCalendarData && typeof window.loadCalendarData === 'function') {
                    console.log('‚úÖ Found loadCalendarData function, calling it...');
                    updateLoadingMessage('Loading calendar data...', 'Fetching events...');
                    try {
                        window.loadCalendarData();
                    } catch (error) {
                        console.error('‚ùå Error calling loadCalendarData:', error);
                        document.getElementById('errorMessage').textContent = `Failed to load calendar data: ${error.message}`;
                        document.getElementById('loadingSection').classList.add('hidden');
                        document.getElementById('errorSection').classList.remove('hidden');
                    }
                } else if (attempts < maxAttempts) {
                    const nextAttempt = attempts + 1;
                    const waitTime = 500;
                    console.log(`‚è≥ loadCalendarData not ready yet, retrying in ${waitTime}ms...`);
                    updateLoadingMessage('Loading...', `Initializing app... (${nextAttempt}/${maxAttempts})`);
                    setTimeout(() => tryLoadCalendarData(nextAttempt, maxAttempts), waitTime);
                } else {
                    console.error('‚ùå Failed to load app.js after', maxAttempts, 'attempts');
                    document.getElementById('errorMessage').textContent = 'Failed to load app. Please refresh the page.';
                    document.getElementById('loadingSection').classList.add('hidden');
                    document.getElementById('errorSection').classList.remove('hidden');
                }
            };
            
            tryLoadCalendarData();
        }
        
        // Start initialization when page loads
        window.onload = initializeAuth;
        
        // Also try when DOM is ready (backup)
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeAuth);
        } else {
            // DOM already ready, but wait a tick for config.js
            setTimeout(initializeAuth, 100);
        }
    </script>
    
    <!-- Load app.js WITHOUT defer so it's available when we need it -->
    <!-- Cache busting: add timestamp to force reload -->
    <script src="app.js?v=20251220-backend-auth"></script>
</body>
</html>
<!-- Reverted to pre-mobile-framework version -->
